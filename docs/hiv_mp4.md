# hivXXXXX.mp4 文件简介

`hivXXXXX.mp4`是行车记录仪的记录文件。虽然扩展名为`.mp4`，但其中记录的数据不一定是视频，也有可能是抓拍的照片。

根据十进制文件编号共有5位，以及`indexXX.bin`文件中表示文件编号的位置大多为二进制16位，推测最多可以支持65536个记录文件。实际的记录文件数量根据SD卡容量、分辨率、HDR等设置的不同一般为几百个。

根据观察，每个`hivXXXXX.mp4`文件的大小都为262144KB，也即`2 ^ 28 = 0x40000000`字节。如果存储视频，每个文件大约可以存储一分钟左右；存储照片则可以存储几百张照片。

## hivXXXXX.mp4 文件分类

经过观察，`hivXXXXX.mp4`文件可以分为三类：普通视频文件，紧急录像视频文件和抓拍文件。

普通视频文件记录正常的行车录像。同时也记录了录音、GPS、加速度计、红绿灯识别等信息。普通视频记录文件会被循环覆盖。

紧急录像文件结构与普通视频完全相同。当按下紧急录像按钮，语音识别到紧急录像指令或者加速度计检测到较大加速度时，会触发紧急录像。此时，当前使用中的文件会被标记为紧急录像文件，并且后续不会被循环覆盖。

当首次语音识别到抓拍指令或停车监控检测到震动时，会触发抓拍。此时，行车记录仪将会把一个`hivXXXXX.mp4`文件确定为存储抓拍用的记录文件。此文件不会被循环覆盖，且后续所有抓拍都将会存储到这个文件当中。

以上三类文件中，普通视频和紧急录像文件只是在`indexXX.bin`文件中被标记了不同的类型，但是他们的文件结构完全相同。所以后面把这两类文件都称为“视频记录文件”，并和拍照记录文件的结构加以区分。

## <span id="jump_mp4_general">hivXXXXX.mp4 文件总体结构</span>

`hivXXXXX.mp4`文件大致符合[MPEG-PS](https://en.wikipedia.org/wiki/MPEG_program_stream)文件格式。MPEG-PS格式详见[ISO/IEC 13818-1](https://www.iso.org/standard/87619.html)标准。

`hivXXXXX.mp4`文件包含数个结构完全相同的分段，对应着`indexXX.bin`文件中所表示的视频记录文件中的视频一个片段或抓拍记录文件中的一**组**照片。总体结构如下表：

| `hivXXXXX.mp4`文件 |
| :----: |
| 第1段 |
| 第2段 |
| ... |

每一分段的结构都相同，可以分为5节，如下表所示：

|  | 相对位置 | 长度 |
| ---- | ---- | ---- |
| 1 | 0x00000 | 0x10000 |
| 2 | 0x10000 | 0x10000 |
| 3 | 0x20000 | 0x1E000 |
| 4 | 0x3E000 | 0x02000 |
| 5 | 0x40000 | 到这部分结尾 |

至于每一分段各节的数据格式，视频文件和抓拍文件差异较大。请参阅[视频文件分段结构](./hiv_mp4_video.md)和[抓拍文件分段结构](./hiv_mp4_photo.md)。

<br/><br/>
返回[SD卡根目录结构](./SD_card.md)
