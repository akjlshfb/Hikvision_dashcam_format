# pkt_id=0x0802 sub_pkt_id=0x0007 二进制格式加速度计/GPS

这类信息以二进制格式记录加速度计和GPS的数据。加速度计与GPS数据格式略有不同。

为了区分加速度计数据和GPS数据：观察到GPS的PES包data总是长`0x8C`，而加速度计data总是长`0x84`。此外，偏移量`0x14 - 0x15`处的数据说明了数据包的信息类型，也可以用来区分。

结构如下表。偏移量指的是从PES包data开始的偏移量。

| 偏移量 | 字节数 | 类型 | 猜测含义 |
| ---- | ---- | ---- | ---- |
| 0x00 | 12 |  | private_header |
| 0x0C | 4 | NA | 不明，总是`0xFF 0xAA 0xFF 0xAA` |
| 0x10 | 4 | NA | 不明，总是`0xDD 0x2A 0x01 0x02` |
| 0x14 | 2 | uint16 | ***信息类型***</br>0x10：加速度计</br>0x20：GPS |
| 0x16 | 14 | NA | 不明，总是`0x00` |
| 0x24 | 2 | uint16 | 年 |
| 0x26 | 2 | uint16 | 月 |
| 0x28 | 2 | uint16 | 星期几（周日为0，依次增加到周六为6） |
| 0x2A | 2 | uint16 | 日 |
| 0x2C | 2 | uint16 | 时 |
| 0x2E | 2 | uint16 | 分 |
| 0x30 | 2 | uint16 | 秒 |
| 0x32 | 2 | NA | 不明，总是`0x00` |
| 0x34 | 4 | uint32 | [内部时间戳](./hiv_mp4_video.md#jump_pts_timestamp)的整数部分 |
| 0x38 | 4 | uint32 | 猜测为private_header后的private_data长度</br>加速度计：总是`0x78`</br>GPS：总是`0x80` |
| 0x3C | 4 | NA | 不明</br>加速度计：总是`0x05 0x01 0x01 0x01`</br>GPS：总是`0x06 0x06 0x01 0x01` |
| 0x40 | 4 | uint32 | 猜测为data中某一部分长度</br>加速度计：总是`0x48`</br>GPS：总是`0x50` |
| 0x44 | 4 | uint32 | [内部时间戳](./hiv_mp4_video.md#jump_pts_timestamp)的整数部分，和`0x34`处的uint32相同 |
| 0x48 | 2 | uint16 | 数据包编号<sup>1</sup> |
| 0x4A |  |  | 加速度计和GPS后续数据格式有所不同，见后文 |

<sup>1</sup> 每出现一个数据包，编号加一。加速度计和GPS数据包各自独立编号。

## 加速度计二进制数据

| 偏移量 | 字节数 | 类型 | 猜测含义 |
| ---- | ---- | ---- | ---- |
| 0x00 | 0x4A |  | 见前文 |
| 0x4A | 30 | NA | 不明，大多数字节都是`0x00` |
| 0x68 | 4 | ***int32*** | z轴加速度，***有符号***，以 $cm \cdot s^{-2}$ 为单位，以**下**方为正方向 |
| 0x6C | 4 | ***int32*** | y轴加速度，***有符号***，以 $cm \cdot s^{-2}$ 为单位，以前方为正方向 |
| 0x70 | 4 | ***int32*** | x轴加速度，***有符号***，以 $cm \cdot s^{-2}$ 为单位，以左方为正方向 |
| 0x74 | 16 | NA | 不明，大多数字节都是`0x00` |

注意这里加速度信息的顺序为 z y x 。

## GPS二进制数据

| 偏移量 | 字节数 | 类型 | 猜测含义 |
| ---- | ---- | ---- | ---- |
| 0x00 | 0x4A |  | 见前文 |
| 0x4A | 26 | NA | 不明，大多数字节都是`0x00` |
| 0x64 | 8 | double | 无符号纬度，以度为单位 |
| 0x6C | 8 | double | 无符号经度，以度为单位 |
| 0x74 | 1 | char | 北纬或南纬：</br>`N`：北纬</br>`S`：南纬 |
| 0x75 | 1 | char | 东经或西经：</br>`E`：东经</br>`W`：西经 |
| 0x76 | 1 | uint8 | 是否定位有效：</br>1：定位有效</br>0：定位无效 |
| 0x77 | 1 | NA | 不明，总是`0x00` |
| 0x78 | 4 | float | 车速，以千米每小时为单位</br>精确到1千米每小时 |
| 0x7C | 4 | float | 速度方位角<sup>1</sup>，以度为单位</br>精确到1度 |
| 0x80 | 12 | NA | 不明，总是`0x00` |

<sup>1</sup> 从天上向下看，从正北顺时针旋转的角度。

## 数据包频率

二进制加速度计数据包没有准确频率，根据观察其频率大约为每秒9个。[文字格式加速度数据](./private_ascii_acce.md)总是来自于之前最近一个二进制数据包的内容。

GPS数据包每秒1个。与市面上大多数GPS模块输出频率相同。

## <span id="jump_gps_data_difference">与header中GPS数据的区别</span>

这里PES包中的GPS数据与`hivXXXXX.mp4`文件分段[header中](./hiv_mp4_video.md#jump_segment_header_gps)的GPS数据稍有不同。下表简要地比较了两者：

|  | 段header中 | PES包中 |
| ---- | ---- | ---- |
| 经纬度数据类型 | uint32 | double |
| 经纬度单位 | 百分之一秒 | 度 |
| 经纬度精度 | 相同 | 相同 |
| 高度信息 | 有 | 无 |
| 速度方位角数据类型 | uint32 | float |
| 速度方位角单位 | 百分之一度 | 度 |
| 速度方位角精度 | 百分之一度 | 度 |

经过分析发现，PES包的GPS总是连贯的，每秒钟位置都会更新。而header的GPS中，从时间戳观察，经纬度、速度和方位角数据通常滞后PES包1-2秒后才被记录到header中。而且header偶尔会“重复”或者“跳过”PES包出现的数据，导致header会“丢掉”一些数据点。

但是，header中出现的数据精度又似乎更高。例如方位角数据，header中的精度为百分之一度，PES中仅为1度。这似乎说明，GPS模块发来NMEA语句后，行车记录仪内部对其进行了一些处理（例如把经纬度的ddmm.mmmm转换为double的度）。PES包仅仅记录了转换中间的结果；header中记录的数据更“原始”，但由于未知原因出现丢包。

header中的高度数据没有“丢包”现象。即使是经纬度发生重复处的数据，高度也在正常更新。

PES包中的时间与GPS位置是同步的。header中的时间戳-2秒后才与位置同步。

<br/><br/>
返回[private_stream_1数据格式](./private_stream_1.md#private_data)
